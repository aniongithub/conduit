---
# Pokemon Fire Type Filter Pipeline - Only downloads Fire-type Pokemon
# Usage: conduit-cli pokemon_filter_fire.yaml --args limit=20

# Step 1: Start with input data
- id: conduit.Input
  data:
    - url: "https://pokeapi.co/api/v2/pokemon?limit=${limit:-10}"
      method: "GET"

# Step 2: Fetch Pokemon list from API
- id: conduit.RestApi
  response_format: "json"

# Step 3: Extract each Pokemon URL from the results
- id: conduit.JsonQuery
  query: ".results[]"

# Step 4: Get detailed Pokemon data
- id: conduit.RestApi
  response_format: "json"

# Step 5: Filter to keep only one type of Pokemon
- id: conduit.Filter
  condition: "any(type_info.type.name == '${type:-fire}' for type_info in item.types)"

# Step 6: Fork to get both URL and filename
- id: conduit.Fork
  paths:
    url:
      - id: conduit.JsonQuery
        query: ".sprites.other.official-artwork.front_default"
    filename:
      - id: conduit.JsonQuery
        query: ".name"
      - id: conduit.Format
        template: "{{input}}.png"

# Step 7: Download the filtered Pokemon image
- id: conduit.DownloadFile
  output_dir: "./pokemon_images"
  create_dirs: true
  overwrite: true

# Step 8: Display the downloaded file path
- id: conduit.Console
  format: "Downloaded ${type}-type Pokemon image: {{input}}"